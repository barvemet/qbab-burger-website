# ========================================
# SECURITY - Protect sensitive files
# ========================================

# Protect .env file from web access
<Files ".env">
    Require all denied
</Files>

# Protect other sensitive files
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Protect config files
<FilesMatch "(config|settings|database)\.php$">
    Require all denied
</FilesMatch>

# ========================================
# MIME Types - Correct content types
# ========================================

# Audio files
AddType audio/mpeg .mp3
AddType audio/mp4 .m4a
AddType audio/ogg .ogg
AddType audio/wav .wav

# Font files
AddType font/otf .otf
AddType font/ttf .ttf
AddType font/woff .woff
AddType font/woff2 .woff2
AddType application/vnd.ms-fontobject .eot

# ========================================
# URL REWRITING
# ========================================

RewriteEngine On

# Force HTTPS (Uncomment when SSL is active)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Ana dizinde index.php'yi çalıştır
DirectoryIndex index.php index.html

# Eğer dosya veya dizin yoksa, index.php'ye yönlendir
# ANCAK admin, api, assets klasörlerini hariç tut
RewriteCond %{REQUEST_URI} !^/(admin|api|assets|includes)/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]

# ========================================
# CACHING - Static assets
# ========================================
<IfModule mod_expires.c>
    ExpiresActive On
    # Images
    ExpiresByType image/jpeg "access plus 30 days"
    ExpiresByType image/png  "access plus 30 days"
    ExpiresByType image/gif  "access plus 30 days"
    ExpiresByType image/webp "access plus 30 days"
    ExpiresByType image/svg+xml "access plus 30 days"
    # Fonts
    ExpiresByType font/woff2 "access plus 30 days"
    ExpiresByType font/woff  "access plus 30 days"
    ExpiresByType font/ttf   "access plus 30 days"
    ExpiresByType font/otf   "access plus 30 days"
    # CSS & JS
    ExpiresByType text/css "access plus 7 days"
    ExpiresByType application/javascript "access plus 7 days"
</IfModule>

# Far-future cache with versioned URLs
<IfModule mod_headers.c>
    <FilesMatch "\.(js|css)$">
        Header set Cache-Control "public, max-age=604800, immutable"
    </FilesMatch>
    <FilesMatch "\.(png|jpg|jpeg|gif|webp|svg|woff2?)$">
        Header set Cache-Control "public, max-age=2592000, immutable"
    </FilesMatch>
</IfModule>
